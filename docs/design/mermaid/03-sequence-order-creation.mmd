sequenceDiagram
    participant C as Customer
    participant F as OrderFacade
    participant PS as ProductService
    participant SS as StockService
    participant OS as OrderService

    C->>F: 주문 요청 (POST /api/v1/orders)
    Note over F: @LoginMember 인증

    activate F
    rect rgb(230, 240, 255)
        Note right of F: @Transactional
        loop 각 주문 상품
            F->>PS: 상품 조회
            alt 삭제된 상품
                PS-->>F: NOT_FOUND
            end
            F->>SS: 재고 확인 및 차감
            alt 재고 부족
                SS-->>F: BAD_REQUEST
                Note over F: 전체 롤백 (All or Nothing)
            end
        end
        F->>OS: 주문 생성 (총액 서버 계산)
        Note over OS: Order + OrderItem 저장
        Note over OS: 스냅샷: 상품명, 가격, 수량
    end
    deactivate F

    F-->>C: 200 OK (주문 정보)